import Callout from 'nextra-theme-docs/callout'

# flask app with Nginx

> using ubuntu linux

## initial set up 

```shell

sudo apt install python3-pip python3-dev build-essential libssl-dev libffi-dev python3-setuptools python3-venv

mkdir ~/flaskapp

cd ~/flaskapp

python3 -m venv flaskappenv

source flaskappenv/bin/activate

pip install wheel

pip install uwsgi flask

```

## create simple file and test

```shell 

echo 'from flask import Flask
app = Flask(__name__)

@app.route("/")
def hello():
    return "<h1 style='color:blue'>Hello There!</h1>"

if __name__ == "__main__":
    app.run(host="0.0.0.0")' >> ~/flaskapp/flaskapp.py

py flaskapp.py
```

## create WSGI entry point

```shell 
echo 'from flaskapp import app

if __name__ == "__main__":
    app.run()' >> ~/flaskapp/wsgi.py
```

## test uWSGI 

```shell
uwsgi --socket 0.0.0.0:5000 --protocol=http -w wsgi:app
```

## create configuration file

```shell
echo '[uwsgi]
module = wsgi:app

master = true
processes = 5

socket = flaskapp.sock
chmod-socket = 660
vacuum = true

die-on-term = true' >> ~/flaskapp/flaskapp.ini
```

## create systemd Unit file

```shell
echo '[Unit]
Description=uWSGI instance to serve myproject
After=network.target

[Service]
User=myusername
Group=www-data
Environment="PATH=/home/myusername/flaskapp/flaskappenv/bin"
ExecStart=/home/myusername/flaskapp/flaskappenv/bin/uwsgi --ini flaskapp.ini

[Install]
WantedBy=multi-user.target' >> flaskapp.service

sudo mv flaskapp.service /etc/systemd/system/

```

## configure Nginx

```shell
echo 'server {
    listen 80;
    server_name your_domain www.your_domain;

    location / {
        include uwsgi_params;
        uwsgi_pass unix:/home/sammy/myproject/myproject.sock;
    }
}' >> ~/flaskapp/flaskapp

sudo cp ~/flaskapp/flaskapp  /etc/nginx/sites-available/

sudo ln -s /etc/nginx/sites-available/flaskapp /etc/nginx/sites-enabled

sudo nginx -t

sudo systemctl restart nginx
```


